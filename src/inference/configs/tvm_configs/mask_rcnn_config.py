import importlib

torch = importlib.import_module('torch')


def do_trace(model, inp):
    model_trace = torch.jit.trace(model, inp)
    model_trace.eval()
    return model_trace


def dict_to_tuple(out_dict):
    if 'masks' in out_dict.keys():
        return out_dict['boxes'], out_dict['scores'], out_dict['labels'], out_dict['masks']
    return out_dict['boxes'], out_dict['scores'], out_dict['labels']


class TraceWrapper(torch.nn.Module):
    def __init__(self, model):
        super().__init__()
        self.model = model

    def forward(self, inp):
        out = self.model(inp)
        return dict_to_tuple(out[0])
